<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Super Hands (versión Ammo sin físicas)</title>
  <!-- Usamos A-Frame >=1.7.1 para mantener compatibilidad con hand-tracking -->
  <script src="https://aframe.io/releases/1.7.1/aframe.min.js"></script>
  <!-- Evitar conflicto con el componente grabbable nativo introducido en A-Frame 1.5.0 -->
  <script>
    if (AFRAME.components['grabbable']) { delete AFRAME.components['grabbable']; }
  </script>
  <!-- Super Hands local (igual que el ejemplo con físicas) -->
  <script src="../dist/super-hands.js"></script>

  <!-- Componente para cambiar color al soltar sobre el transformador (sin físicas) -->
  <script>
    AFRAME.registerComponent('color-randomizer-drop', {
      init: function () {
        // Se ejecuta en el droppable (transformer)
        this.el.addEventListener('drag-drop', function (evt) {
          // evt.detail.dropped es el elemento soltado
          const target = evt.detail && evt.detail.dropped;
          if (target) {
            target.setAttribute('material', 'color', '#' + (Math.random() * 0xFFFFFF << 0).toString(16));
          }
        });
      }
    });
  </script>
  <style>
    body { margin:0; }
  </style>
</head>
<body>
  <!-- Escena sin sistema de físicas: NO gravedad, NO colisiones físicas -->
  <a-scene vr-mode-ui="enabled: true" webxr="optionalFeatures: hand-tracking">
    <!-- Rig básico con cámara y manos -->
    <a-entity id="rig">
      <!-- Mano izquierda -->
      <a-entity id="lhand"
                hand-controls="hand: left"
                sphere-collider="objects: .interactuable; radius: 0.09"
                super-hands="colliderEvent: hitstart;
                             colliderEventProperty: el;
                             colliderEndEvent: hitend;
                             colliderEndEventProperty: el;
                             grabStartButtons: gripdown, triggerdown;
                             grabEndButtons: gripup, triggerup;
                             debug: true">
      </a-entity>
      <!-- Mano derecha -->
      <a-entity id="rhand"
                hand-controls="hand: right"
                sphere-collider="objects: .interactuable; radius: 0.09"
                super-hands="colliderEvent: hitstart;
                             colliderEventProperty: el;
                             colliderEndEvent: hitend;
                             colliderEndEventProperty: el;
                             grabStartButtons: gripdown, triggerdown;
                             grabEndButtons: gripup, triggerup;
                             debug: true">
      </a-entity>
    </a-entity>

    <!-- Mixins para reutilizar configuraciones similares al ejemplo Ammo -->
    <a-assets>
      <a-mixin id="cube"
               geometry="primitive: box; width: 0.33; height: 0.33; depth: 0.33"
               hoverable
               grabbable
               stretchable
               draggable
               droppable
               event-set__hoveron="_event: hover-start; material.opacity: 0.6; transparent: true"
               event-set__hoveroff="_event: hover-end; material.opacity: 1; transparent: false"
               material="color: #AAA">
      </a-mixin>
      <a-mixin id="transformer"
               geometry="primitive: box; width: 0.5; height: 0.5; depth: 0.5"
               droppable
               color-randomizer-drop
               event-set__dragon="_event: dragover-start; material.wireframe: true"
               event-set__dragoff="_event: dragover-end; material.wireframe: false"
               material="color: #444">
      </a-mixin>
    </a-assets>

    <!-- Texto explicativo -->
    <a-text value="Versión del demo Ammo SIN físicas.\nLos cubos no caen ni chocan físicamente.\nPuedes: hover, grab, drag, stretch, drop.\nSoltar sobre el transformador cambia el color del cubo." 
            position="-2 2 -3" width="4" color="#CCC"></a-text>

    <!-- Cubos (similar distribución) -->
    <a-entity class="interactuable cube" mixin="cube" position="0 1 -1" material="color: red"></a-entity>
    <a-entity class="interactuable cube" mixin="cube" position="0 1 -0.3" material="color: red"></a-entity>
    <a-entity class="interactuable cube" mixin="cube" position="-0.9 1 -1" material="color: blue"></a-entity>
    <a-entity class="interactuable cube" mixin="cube" position="-0.9 1 -0.3" material="color: blue"></a-entity>
    <a-entity class="interactuable cube" mixin="cube" position="0.9 1 -1" material="color: green"></a-entity>
    <a-entity class="interactuable cube" mixin="cube" position="0.9 1 -0.3" material="color: green"></a-entity>

    <!-- Transformador que produce el cambio de color -->
    <a-entity class="interactuable" mixin="transformer" position="0 1.6 -1"></a-entity>

    <!-- Una "plataforma" meramente visual sin física -->
    <a-box position="0 0.4 -1" width="3" height="0.2" depth="2" color="#222" opacity="0.4"></a-box>

    <a-sky color="#111"></a-sky>
  </a-scene>
</body>
</html>
